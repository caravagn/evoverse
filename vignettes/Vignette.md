mvMOBSTER Vignette
================
Giulio Caravagna
21 February 2019

## Example data

``` r
data("example_mvmobster", package = 'mvmobster')
print(example_mvmobster)
```

    ## $muts
    ## # A tibble: 500 x 37
    ##    id    patient region gene  chr     from     to ref   alt   vartype
    ##    <chr> <chr>   <chr>  <chr> <chr>  <int>  <int> <chr> <chr> <chr>  
    ##  1 chr5… Set6    inter… LYSM… chr5  8.98e7 8.98e7 G     A     SNP    
    ##  2 chrY… Set6    inter… TTTY… chrY  1.00e7 1.00e7 G     T     SNP    
    ##  3 chr1… Set6    intro… TRHDE chr12 7.29e7 7.29e7 C     A     SNP    
    ##  4 chr1… Set6    inter… NLK(… chr17 2.66e7 2.66e7 G     A     SNP    
    ##  5 chr1… Set6    intro… GALN… chr11 1.14e7 1.14e7 T     G     SNP    
    ##  6 chr1… Set6    intro… MRPL… chr1  5.47e7 5.47e7 A     G     SNP    
    ##  7 chr1… Set6    intro… LMNB2 chr19 2.45e6 2.45e6 C     G     SNP    
    ##  8 chr1… Set6    inter… NRG3… chr10 8.48e7 8.48e7 A     C     SNP    
    ##  9 chr3… Set6    inter… RBMS… chr3  3.01e7 3.01e7 A     G     SNP    
    ## 10 chr6… Set6    inter… LOC1… chr6  1.00e7 1.00e7 C     T     SNP    
    ## # ... with 490 more rows, and 27 more variables: function. <chr>,
    ## #   mutlocation <chr>, cosmic <chr>, Set6_42.VAF <dbl>, Set6_44.VAF <dbl>,
    ## #   Set6_45.VAF <dbl>, Set6_46.VAF <dbl>, Set6_47.VAF <dbl>,
    ## #   Set6_48.VAF <dbl>, Set6_42.DP <dbl>, Set6_44.DP <dbl>,
    ## #   Set6_45.DP <dbl>, Set6_46.DP <dbl>, Set6_47.DP <dbl>,
    ## #   Set6_48.DP <dbl>, Set6_42.NV <dbl>, Set6_44.NV <dbl>,
    ## #   Set6_45.NV <dbl>, Set6_46.NV <dbl>, Set6_47.NV <dbl>,
    ## #   Set6_48.NV <dbl>, Set6_42_N.VAF <dbl>, Set6_44_N.VAF <dbl>,
    ## #   Set6_45_N.VAF <dbl>, Set6_46_N.VAF <dbl>, Set6_47_N.VAF <dbl>,
    ## #   Set6_48_N.VAF <dbl>
    ## 
    ## $segments
    ##      chr      from        to Set6_42.minor Set6_42.Major Set6_44.minor
    ## 1   chr1   1421022   2538349             1             1             1
    ## 2   chr1   3428160  47139103             0             1             0
    ## 3   chr1  48708250 247694949             1             1             1
    ## 4   chr1 247726822 247726822             0             2             0
    ## 5   chr2    224919 242557019             1             1             1
    ## 6   chr3   2908335 197273077             1             1             1
    ## 7   chr4    818440   1739252             1             1             1
    ## 8   chr4   1746125  10599670             1             1             1
    ## 9   chr4  13529990 190894246             1             1             1
    ## 10  chr4 190903688 190904832             1             2             1
    ## 11  chr5   1880891  58476232             1             1             1
    ## 12  chr5  61642937  76722442             1             1             1
    ## 13  chr5  78573790 160044894             0             2             0
    ## 14  chr5 161111193 161579441             0             2             0
    ## 15  chr5 168189501 179269075             0             2             0
    ## 16  chr6   1742794  22292976             0             2             0
    ## 17  chr6  24146454  30313340             1             1             0
    ## 18  chr6  30453795  31745284             0             2             0
    ## 19  chr6  31778077  32827364             0             2             0
    ## 20  chr6  32902583  34026724             1             1             0
    ## 21  chr6  34735676  34949607             1             2             0
    ## 22  chr6  35047579  35425416             0             2             0
    ## 23  chr6  35542476  37447075             0             2             0
    ## 24  chr6  38338015  40400868             1             1             1
    ## 25  chr6  41176759  42036395             1             2             1
    ## 26  chr6  42225993  42231419             0             2             1
    ## 27  chr6  42571346 169857761             1             1             1
    ## 28  chr7   1089458   1894116             1             1             1
    ## 29  chr7   2041638   7613039             1             1             1
    ## 30  chr7   8560178 158902425             1             1             1
    ## 31  chr8   1808256 141568725             1             1             1
    ## 32  chr8 142490120 143425720             1             1             1
    ## 33  chr9    990840 128978468             1             1             1
    ## 34  chr9 129158002 140416025             1             1             1
    ## 35 chr10    329188  64159333             1             1             1
    ## 36 chr10  69684961  92503619             0             1             0
    ## 37 chr10  92645687 134898594             1             1             1
    ## 38 chr11    609353   4880892             1             1             1
    ## 39 chr11   4928866   5384003             1             1             0
    ## 40 chr11   5410934  55798259             1             1             1
    ## 41 chr11  55839278  76923017             1             1             1
    ## 42 chr11  78277277  88338165             1             1             1
    ## 43 chr11  93103419  93534990             1             1             1
    ## 44 chr11  93801012 134238518             1             1             1
    ## 45 chr12    661656   7655278             1             1             1
    ## 46 chr12   9334769 122243905             1             1             1
    ## 47 chr12 122492598 122498002             1             1             1
    ## 48 chr12 122606596 122606662             0             2             0
    ## 49 chr12 122614060 131155677             1             1             1
    ## 50 chr12 133363376 133378440             1             1             1
    ## 51 chr13  21063524 115064542             1             1             1
    ## 52 chr14  20820537 106377944             1             1             1
    ## 53 chr14 106780634 106781023             1             1             1
    ## 54 chr14 106790942 107283150             1             1             1
    ## 55 chr15  25953068  27188459             1             1             1
    ## 56 chr15  33533869  60715800             1             1             1
    ## 57 chr15  62535030  62538959             1             1             0
    ## 58 chr15  63054439  67008737             1             1             1
    ## 59 chr15  67501782  67951150             1             1             1
    ## 60 chr15  68050857 101812924             1             1             1
    ## 61 chr16    420140   5106050             1             1             1
    ## 62 chr16   7696691  89763619             1             1             1
    ## 63 chr17    423051  39197499             1             1             1
    ## 64 chr17  39346621  39458893             1             2             1
    ## 65 chr17  39551099  39791686             1             1             1
    ## 66 chr17  40271757  48693760             1             1             1
    ## 67 chr17  49054439  68931722             1             1             1
    ## 68 chr17  71167521  81052042             1             1             1
    ## 69 chr18    166819  77926795             0             1             0
    ## 70 chr19    727448  19946637             1             1             1
    ## 71 chr19  31038995  36585111             1             1             1
    ## 72 chr19  36940698  38202414             1             1             1
    ## 73 chr19  38282727  38385695             1             1             1
    ## 74 chr19  38935280  42354629             1             1             1
    ## 75 chr19  44376681  44936245             1             1             1
    ## 76 chr19  45206984  58697290             1             1             1
    ## 77 chr20    264498  25195509             0             1             0
    ## 78 chr20  30662247  60294388             1             2             1
    ## 79 chr20  60315268  62904542             1             2             1
    ## 80 chr21  16015250  32253629             1             1             1
    ## 81 chr21  32519135  33039774             1             1             1
    ## 82 chr21  33053987  48078611             1             1             1
    ## 83 chr22  19379555  22724341             1             1             1
    ## 84 chr22  22758488  23135588             1             2             1
    ## 85 chr22  24447303  51018579             1             1             1
    ##    Set6_44.Major Set6_45.minor Set6_45.Major Set6_46.minor Set6_46.Major
    ## 1              1             1             1             0             1
    ## 2              1             0             1             0             0
    ## 3              1             1             1             1             1
    ## 4              2             0             2             0             2
    ## 5              1             1             1             1             1
    ## 6              1             1             1             1             1
    ## 7              1             1             1             0             1
    ## 8              1             1             1             0             1
    ## 9              1             1             1             1             1
    ## 10             2             1             2             1             2
    ## 11             1             1             1             1             1
    ## 12             1             1             1             1             1
    ## 13             2             0             2             0             2
    ## 14             2             0             2             0             2
    ## 15             2             0             2             0             2
    ## 16             2             1             1             1             1
    ## 17             2             1             1             1             1
    ## 18             2             1             1             1             1
    ## 19             2             1             1             1             1
    ## 20             2             1             1             1             1
    ## 21             2             1             1             1             1
    ## 22             2             1             1             1             1
    ## 23             2             1             1             1             1
    ## 24             1             1             1             1             1
    ## 25             1             1             1             1             1
    ## 26             1             1             1             1             1
    ## 27             1             1             1             1             1
    ## 28             1             1             1             0             1
    ## 29             1             1             1             0             1
    ## 30             1             1             1             1             1
    ## 31             1             1             1             1             1
    ## 32             1             1             1             1             1
    ## 33             1             1             1             1             1
    ## 34             1             1             1             0             1
    ## 35             1             1             1             1             1
    ## 36             1             0             1             0             0
    ## 37             1             1             1             1             1
    ## 38             1             1             1             0             1
    ## 39             2             1             1             0             2
    ## 40             1             1             1             1             1
    ## 41             1             1             1             0             1
    ## 42             1             1             1             1             1
    ## 43             1             1             1             1             1
    ## 44             1             1             1             1             1
    ## 45             1             1             1             0             1
    ## 46             1             1             1             1             1
    ## 47             1             1             1             1             1
    ## 48             2             1             1             1             2
    ## 49             1             1             1             1             1
    ## 50             1             1             1             0             1
    ## 51             1             1             1             1             1
    ## 52             1             1             1             1             1
    ## 53             1             1             1             1             2
    ## 54             1             1             1             0             2
    ## 55             1             1             1             1             1
    ## 56             1             1             1             0             2
    ## 57             2             1             1             0             2
    ## 58             1             1             1             0             2
    ## 59             1             1             1             0             1
    ## 60             1             1             1             0             1
    ## 61             1             1             1             0             1
    ## 62             1             1             1             0             1
    ## 63             1             1             1             0             1
    ## 64             3             1             2             0             2
    ## 65             1             1             1             0             1
    ## 66             1             1             1             0             1
    ## 67             1             1             1             0             1
    ## 68             1             1             1             0             1
    ## 69             1             0             1             0             0
    ## 70             1             1             1             0             1
    ## 71             1             1             1             0             1
    ## 72             1             1             1             1             1
    ## 73             1             1             1             0             1
    ## 74             1             1             1             0             1
    ## 75             2             1             1             1             1
    ## 76             1             1             1             0             1
    ## 77             1             0             1             0             0
    ## 78             2             1             2             1             2
    ## 79             2             1             2             0             2
    ## 80             1             1             1             1             1
    ## 81             2             1             1             0             1
    ## 82             1             1             1             0             1
    ## 83             1             1             1             0             1
    ## 84             2             1             1             1             1
    ## 85             1             1             1             0             1
    ##    Set6_47.minor Set6_47.Major Set6_48.minor Set6_48.Major
    ## 1              0             1             0             1
    ## 2              0             1             0             0
    ## 3              1             1             1             1
    ## 4              1             1             1             1
    ## 5              1             1             1             1
    ## 6              1             1             1             1
    ## 7              1             1             0             1
    ## 8              1             1             1             1
    ## 9              1             1             1             1
    ## 10             1             2             1             2
    ## 11             1             1             1             1
    ## 12             1             1             1             1
    ## 13             0             2             0             2
    ## 14             0             2             0             2
    ## 15             0             2             0             2
    ## 16             0             2             0             2
    ## 17             0             2             0             2
    ## 18             0             2             0             2
    ## 19             1             1             0             2
    ## 20             1             1             0             2
    ## 21             1             1             0             2
    ## 22             1             1             0             2
    ## 23             1             1             1             1
    ## 24             1             1             1             1
    ## 25             1             1             1             1
    ## 26             1             1             1             1
    ## 27             1             1             1             1
    ## 28             0             1             0             0
    ## 29             1             1             1             1
    ## 30             1             1             1             1
    ## 31             1             1             1             1
    ## 32             1             1             1             1
    ## 33             1             1             1             1
    ## 34             1             1             0             1
    ## 35             1             1             1             1
    ## 36             0             1             0             1
    ## 37             1             1             1             1
    ## 38             1             1             0             1
    ## 39             1             1             1             1
    ## 40             1             1             1             1
    ## 41             1             1             1             1
    ## 42             1             1             1             1
    ## 43             1             1             1             1
    ## 44             1             1             1             1
    ## 45             1             1             1             1
    ## 46             1             1             1             1
    ## 47             1             1             1             1
    ## 48             1             1             1             1
    ## 49             1             1             1             1
    ## 50             1             1             0             1
    ## 51             1             1             1             1
    ## 52             1             1             1             1
    ## 53             1             1             1             1
    ## 54             1             1             1             1
    ## 55             1             1             0             2
    ## 56             0             2             0             2
    ## 57             0             2             0             2
    ## 58             0             2             0             2
    ## 59             0             2             0             2
    ## 60             0             2             0             2
    ## 61             1             1             0             1
    ## 62             1             1             1             1
    ## 63             1             1             0             1
    ## 64             1             1             1             1
    ## 65             1             1             1             1
    ## 66             1             1             0             1
    ## 67             1             1             1             1
    ## 68             0             1             0             1
    ## 69             0             1             0             1
    ## 70             1             1             0             1
    ## 71             1             1             1             1
    ## 72             1             1             1             1
    ## 73             1             1             1             1
    ## 74             1             1             0             1
    ## 75             1             1             1             1
    ## 76             1             1             0             1
    ## 77             0             1             0             1
    ## 78             1             2             1             2
    ## 79             1             1             1             1
    ## 80             1             1             1             1
    ## 81             1             1             1             1
    ## 82             1             1             0             1
    ## 83             1             1             0             1
    ## 84             1             1             1             1
    ## 85             1             1             0             1
    ## 
    ## $samples
    ## [1] "Set6_42" "Set6_44" "Set6_45" "Set6_46" "Set6_47" "Set6_48"

Set purity

``` r
pur = rep(1, 6)
names(pur) = example_mvmobster$samples
```

Create a mvMOBSTER object (of class `mbs_data`).

``` r
x = mobster_dataset(
  mutations = example_mvmobster$muts,
  samples = example_mvmobster$samples[1:3], 
  segments = example_mvmobster$segments,
  purity = pur[1:3], 
  N.min = 0
)
```

    ##  [ mvMOBSTER dataset ] 
    ##  Mutations N = 500 
    ##  Melting data  OK

    ## Warning: package 'bindrcpp' was built under R version 3.4.4

    ## Your list of segments contains more sample IDs that those used -- will be dropped.

    ## 
    ## ---------------------------------
    ## Mapping mutations to CN segments.
    ## ---------------------------------
    ##  Offset around centromers (hg19) 1e+06 
    ## 
      |                                                                       
      |                                                                 |   0%
      |                                                                       
      |=                                                                |   1%
      |                                                                       
      |==                                                               |   2%
      |                                                                       
      |==                                                               |   4%
      |                                                                       
      |===                                                              |   5%
      |                                                                       
      |====                                                             |   6%
      |                                                                       
      |=====                                                            |   7%
      |                                                                       
      |=====                                                            |   8%
      |                                                                       
      |======                                                           |   9%
      |                                                                       
      |=======                                                          |  11%
      |                                                                       
      |========                                                         |  12%
      |                                                                       
      |========                                                         |  13%
      |                                                                       
      |=========                                                        |  14%
      |                                                                       
      |==========                                                       |  15%
      |                                                                       
      |===========                                                      |  16%
      |                                                                       
      |===========                                                      |  18%
      |                                                                       
      |============                                                     |  19%
      |                                                                       
      |=============                                                    |  20%
      |                                                                       
      |==============                                                   |  21%
      |                                                                       
      |===============                                                  |  22%
      |                                                                       
      |===============                                                  |  24%
      |                                                                       
      |================                                                 |  25%
      |                                                                       
      |=================                                                |  26%
      |                                                                       
      |==================                                               |  27%
      |                                                                       
      |==================                                               |  28%
      |                                                                       
      |===================                                              |  29%
      |                                                                       
      |====================                                             |  31%
      |                                                                       
      |=====================                                            |  32%
      |                                                                       
      |=====================                                            |  33%
      |                                                                       
      |======================                                           |  34%
      |                                                                       
      |=======================                                          |  35%
      |                                                                       
      |========================                                         |  36%
      |                                                                       
      |========================                                         |  38%
      |                                                                       
      |=========================                                        |  39%
      |                                                                       
      |==========================                                       |  40%
      |                                                                       
      |===========================                                      |  41%
      |                                                                       
      |============================                                     |  42%
      |                                                                       
      |============================                                     |  44%
      |                                                                       
      |=============================                                    |  45%
      |                                                                       
      |==============================                                   |  46%
      |                                                                       
      |===============================                                  |  47%
      |                                                                       
      |===============================                                  |  48%
      |                                                                       
      |================================                                 |  49%
      |                                                                       
      |=================================                                |  51%
      |                                                                       
      |==================================                               |  52%
      |                                                                       
      |==================================                               |  53%
      |                                                                       
      |===================================                              |  54%
      |                                                                       
      |====================================                             |  55%
      |                                                                       
      |=====================================                            |  56%
      |                                                                       
      |=====================================                            |  58%
      |                                                                       
      |======================================                           |  59%
      |                                                                       
      |=======================================                          |  60%
      |                                                                       
      |========================================                         |  61%
      |                                                                       
      |=========================================                        |  62%
      |                                                                       
      |=========================================                        |  64%
      |                                                                       
      |==========================================                       |  65%
      |                                                                       
      |===========================================                      |  66%
      |                                                                       
      |============================================                     |  67%
      |                                                                       
      |============================================                     |  68%
      |                                                                       
      |=============================================                    |  69%
      |                                                                       
      |==============================================                   |  71%
      |                                                                       
      |===============================================                  |  72%
      |                                                                       
      |===============================================                  |  73%
      |                                                                       
      |================================================                 |  74%
      |                                                                       
      |=================================================                |  75%
      |                                                                       
      |==================================================               |  76%
      |                                                                       
      |==================================================               |  78%
      |                                                                       
      |===================================================              |  79%
      |                                                                       
      |====================================================             |  80%
      |                                                                       
      |=====================================================            |  81%
      |                                                                       
      |======================================================           |  82%
      |                                                                       
      |======================================================           |  84%
      |                                                                       
      |=======================================================          |  85%
      |                                                                       
      |========================================================         |  86%
      |                                                                       
      |=========================================================        |  87%
      |                                                                       
      |=========================================================        |  88%
      |                                                                       
      |==========================================================       |  89%
      |                                                                       
      |===========================================================      |  91%
      |                                                                       
      |============================================================     |  92%
      |                                                                       
      |============================================================     |  93%
      |                                                                       
      |=============================================================    |  94%
      |                                                                       
      |==============================================================   |  95%
      |                                                                       
      |===============================================================  |  96%
      |                                                                       
      |===============================================================  |  98%
      |                                                                       
      |================================================================ |  99%
      |                                                                       
      |=================================================================| 100% 
    ## 
    ## Outside segments N = 67 (13%)
    ## 
    ## -----------------------------------
    ## Segments report (cutoff 0 muts/seg)
    ## -----------------------------------
    ##  
    ## N < 0 0 (rejected)
    ## # A tibble: 0 x 5
    ## # ... with 5 variables: seg_id <chr>, N <int>, chr <chr>, from <int>,
    ## #   to <int>
    ##  
    ## N >= 0 50 (accepted)# A tibble: 50 x 5
    ##    seg_id        N chr       from        to
    ##    <chr>     <int> <chr>    <int>     <int>
    ##  1 _CN_seg3     34 chr1  48708250 247694949
    ##  2 _CN_seg5     33 chr2    224919 242557019
    ##  3 _CN_seg33    28 chr9    990840 128978468
    ##  4 _CN_seg30    27 chr7   8560178 158902425
    ##  5 _CN_seg6     26 chr3   2908335 197273077
    ##  6 _CN_seg31    23 chr8   1808256 141568725
    ##  7 _CN_seg9     22 chr4  13529990 190894246
    ##  8 _CN_seg13    17 chr5  78573790 160044894
    ##  9 _CN_seg46    17 chr12  9334769 122243905
    ## 10 _CN_seg62    16 chr16  7696691  89763619
    ## # ... with 40 more rows
    ## 
    ## --------------------------------------------------
    ## Adjusting the VAF for 433 entries across 3 samples
    ## --------------------------------------------------
    ## 
      |                                                                       
      |                                                                 |   0%
      |                                                                       
      |=                                                                |   2%
      |                                                                       
      |===                                                              |   4%
      |                                                                       
      |====                                                             |   6%
      |                                                                       
      |=====                                                            |   8%
      |                                                                       
      |======                                                           |  10%
      |                                                                       
      |========                                                         |  12%
      |                                                                       
      |=========                                                        |  14%
      |                                                                       
      |==========                                                       |  16%
      |                                                                       
      |============                                                     |  18%
      |                                                                       
      |=============                                                    |  20%
      |                                                                       
      |==============                                                   |  22%
      |                                                                       
      |================                                                 |  24%
      |                                                                       
      |=================                                                |  26%
      |                                                                       
      |==================                                               |  28%
      |                                                                       
      |====================                                             |  30%
      |                                                                       
      |=====================                                            |  32%
      |                                                                       
      |======================                                           |  34%
      |                                                                       
      |=======================                                          |  36%
      |                                                                       
      |=========================                                        |  38%
      |                                                                       
      |==========================                                       |  40%
      |                                                                       
      |===========================                                      |  42%
      |                                                                       
      |=============================                                    |  44%
      |                                                                       
      |==============================                                   |  46%
      |                                                                       
      |===============================                                  |  48%
      |                                                                       
      |================================                                 |  50%
      |                                                                       
      |==================================                               |  52%
      |                                                                       
      |===================================                              |  54%
      |                                                                       
      |====================================                             |  56%
      |                                                                       
      |======================================                           |  58%
      |                                                                       
      |=======================================                          |  60%
      |                                                                       
      |========================================                         |  62%
      |                                                                       
      |==========================================                       |  64%
      |                                                                       
      |===========================================                      |  66%
      |                                                                       
      |============================================                     |  68%
      |                                                                       
      |==============================================                   |  70%
      |                                                                       
      |===============================================                  |  72%
      |                                                                       
      |================================================                 |  74%
      |                                                                       
      |=================================================                |  76%
      |                                                                       
      |===================================================              |  78%
      |                                                                       
      |====================================================             |  80%
      |                                                                       
      |=====================================================            |  82%
      |                                                                       
      |=======================================================          |  84%
      |                                                                       
      |========================================================         |  86%
      |                                                                       
      |=========================================================        |  88%
      |                                                                       
      |==========================================================       |  90%
      |                                                                       
      |============================================================     |  92%
      |                                                                       
      |=============================================================    |  94%
      |                                                                       
      |==============================================================   |  96%
      |                                                                       
      |================================================================ |  98%
      |                                                                       
      |=================================================================| 100%

    ## 
    ## N = 182 entries have VAF = 0 in all samples, will be removed.

Which has its own S3 print and plot functions

``` r
print(x)
```

    ##  [ mvMOBSTER dataset ] 
    ##    Dataset = My multi-region MOBSTER dataset  
    ##    Samples = Set6_42, Set6_44, Set6_45  
    ##  Mutations = N = 433  
    ## 
    ## --------------------------------------------------------------------------------------
    ## Coverage (DP), reads with mutant (NV) and allele frequency (VAF) -- min | median | max
    ## --------------------------------------------------------------------------------------
    ##    sample              DP               NV                VAF
    ## 1 Set6_42  18 |  79 | 137    2 |  11 |  54 0.03 | 0.21 | 0.88
    ## 2 Set6_44  22 |  64 | 181    3 |  16 |  46 0.02 | 0.25 | 0.68
    ## 3 Set6_45  12 |  73 | 173   2 | 18.5 |  45  0.03 | 0.26 | 0.7
    ## 
    ## 
    ##  Annotations patient, region, gene, ref, alt, vartype, ... 
    ## 
    ## -----------------
    ## LOGGED OPERATIONS
    ## -----------------
    ## # A tibble: 2 x 2
    ##   time                operation                
    ##   <dttm>              <chr>                    
    ## 1 2019-02-21 13:10:49 Initialization           
    ## 2 2019-02-21 13:10:51 Added CN and adjusted VAF

``` r
#plot(x)
```

## Data manipulation

To accessing the data (without modifying it)

``` r
VAF(x)
```

    ## # A tibble: 1,299 x 4
    ##    id       variable  value sample 
    ##    <chr>    <chr>     <dbl> <chr>  
    ##  1 __mut252 VAF      0      Set6_42
    ##  2 __mut256 VAF      0      Set6_42
    ##  3 __mut272 VAF      0      Set6_42
    ##  4 __mut348 VAF      0      Set6_42
    ##  5 __mut415 VAF      0      Set6_42
    ##  6 __mut441 VAF      0.0538 Set6_42
    ##  7 __mut252 VAF      0      Set6_44
    ##  8 __mut256 VAF      0.05   Set6_44
    ##  9 __mut272 VAF      0      Set6_44
    ## 10 __mut348 VAF      0.0439 Set6_44
    ## # ... with 1,289 more rows

``` r
VAF_table(x)
```

    ## # A tibble: 433 x 4
    ##    id       Set6_42.VAF Set6_44.VAF Set6_45.VAF
    ##    <chr>          <dbl>       <dbl>       <dbl>
    ##  1 __mut252      0           0                0
    ##  2 __mut256      0           0.05             0
    ##  3 __mut272      0           0                0
    ##  4 __mut348      0           0.0439           0
    ##  5 __mut415      0           0.0463           0
    ##  6 __mut441      0.0538      0                0
    ##  7 __mut6        0           0                0
    ##  8 __mut23       0           0                0
    ##  9 __mut69       0.0460      0                0
    ## 10 __mut87       0           0                0
    ## # ... with 423 more rows

To accessing the data (without modifying it)

``` r
# plot_filters(x, 
#              VAF_min = 0.05, 
#             NV_min = 3, 
#             min.DP = 0, 
#             max.DP = Inf, 
#             min.VAF = 0.05, 
#             max.VAF = 0.8, 
#             x.lim = NA, 
#             y.lim = NA)
```

You ca filter …

## Fitting MOBSTER

``` r
fit = mobster_fit_multivariate(x)
```

    ## 
    ## -----------------------------------
    ## Fitting with MOBSTER sample Set6_42
    ## -----------------------------------
    ## # A tibble: 154 x 3
    ##    id       sample     VAF
    ##    <chr>    <chr>    <dbl>
    ##  1 __mut10  Set6_42 0.509 
    ##  2 __mut100 Set6_42 0.0820
    ##  3 __mut102 Set6_42 0.406 
    ##  4 __mut105 Set6_42 0.207 
    ##  5 __mut109 Set6_42 0.256 
    ##  6 __mut110 Set6_42 0.404 
    ##  7 __mut116 Set6_42 0.408 
    ##  8 __mut12  Set6_42 0.174 
    ##  9 __mut122 Set6_42 0.417 
    ## 10 __mut126 Set6_42 0.417 
    ## # ... with 144 more rows
    ##  [ MOBSTER fit ] 
    ## 
    ##  - N = 154 samples with K = 1 2 3 Beta; Pareto Type-I power-law tail: YES NO
    ##  - Fit   :  MM for 2000 max. steps with peaks initialization; ε = 1e-10 . Model selection:  reICL
    ##  - Runs  :  5  x  3  x  2 = 30 
    ##  [easypar] Registering multiple cores:  2 out of 4 [ratio 80%] 
    ##  [easypar] Stopping parallel clusters.   
    ## 
    ## 
    ## COMPLETED. 0.3 mins 
    ## 
    ##  BEST FIT: reICL 
    ## 
    ## [ MOBSTER ] N = 154 points with K = 3 Beta clusters, fit by MM in 186 steps [CONVERGED] 
    ## 
    ##   Components (fit)  
    ## Tail OFF
    ##   Beta C1    n = 1 (0.01)     Mean = 0.88
    ##   Beta C2    n = 79 (0.51)    Mean = 0.34
    ##   Beta C3    n = 74 (0.48)    Mean = 0.08
    ## 
    ##   Scores (model selection)  
    ##        NLL       BIC       AIC  entropy       ICL reduced.entropy
    ##  -150.8785 -246.3506 -279.7571 4.341417 -242.0092        4.341417
    ##      reICL size
    ##  -242.0092   11
    ## 
    ## -----------------------------------
    ## Fitting with MOBSTER sample Set6_44
    ## -----------------------------------
    ## # A tibble: 122 x 3
    ##    id       sample    VAF
    ##    <chr>    <chr>   <dbl>
    ##  1 __mut10  Set6_44 0.513
    ##  2 __mut102 Set6_44 0.212
    ##  3 __mut109 Set6_44 0.377
    ##  4 __mut110 Set6_44 0.355
    ##  5 __mut116 Set6_44 0.303
    ##  6 __mut126 Set6_44 0.414
    ##  7 __mut127 Set6_44 0.351
    ##  8 __mut13  Set6_44 0.358
    ##  9 __mut131 Set6_44 0.363
    ## 10 __mut139 Set6_44 0.486
    ## # ... with 112 more rows
    ##  [ MOBSTER fit ] 
    ## 
    ##  - N = 122 samples with K = 1 2 3 Beta; Pareto Type-I power-law tail: YES NO
    ##  - Fit   :  MM for 2000 max. steps with peaks initialization; ε = 1e-10 . Model selection:  reICL
    ##  - Runs  :  5  x  3  x  2 = 30 
    ##  [easypar] Registering multiple cores:  2 out of 4 [ratio 80%] 
    ##  [easypar] Stopping parallel clusters.   
    ## 
    ## 
    ## COMPLETED. 0.24 mins 
    ## 
    ##  BEST FIT: reICL 
    ## 
    ## [ MOBSTER ] N = 122 points with K = 1 Beta clusters, fit by MM in 1 steps [CONVERGED] 
    ## 
    ##   Components (fit)  
    ## Tail OFF
    ##   Beta C1    n = 122 (1)      Mean = 0.25
    ## 
    ##   Scores (model selection)  
    ##        NLL       BIC       AIC entropy       ICL reduced.entropy     reICL
    ##  -68.16518 -112.3103 -126.3304       0 -112.3103               0 -112.3103
    ##  size
    ##     5
    ## 
    ## -----------------------------------
    ## Fitting with MOBSTER sample Set6_45
    ## -----------------------------------
    ## # A tibble: 138 x 3
    ##    id       sample     VAF
    ##    <chr>    <chr>    <dbl>
    ##  1 __mut102 Set6_45 0.327 
    ##  2 __mut109 Set6_45 0.309 
    ##  3 __mut110 Set6_45 0.419 
    ##  4 __mut116 Set6_45 0.447 
    ##  5 __mut119 Set6_45 0.0556
    ##  6 __mut122 Set6_45 0.407 
    ##  7 __mut124 Set6_45 0.0490
    ##  8 __mut126 Set6_45 0.405 
    ##  9 __mut127 Set6_45 0.446 
    ## 10 __mut13  Set6_45 0.432 
    ## # ... with 128 more rows
    ##  [ MOBSTER fit ] 
    ## 
    ##  - N = 138 samples with K = 1 2 3 Beta; Pareto Type-I power-law tail: YES NO
    ##  - Fit   :  MM for 2000 max. steps with peaks initialization; ε = 1e-10 . Model selection:  reICL
    ##  - Runs  :  5  x  3  x  2 = 30 
    ##  [easypar] Registering multiple cores:  2 out of 4 [ratio 80%] 
    ##  [easypar] Stopping parallel clusters.   
    ## 
    ## 
    ## COMPLETED. 0.21 mins 
    ## 
    ##  BEST FIT: reICL 
    ## 
    ## [ MOBSTER ] N = 138 points with K = 1 Beta clusters, fit by MM in 56 steps [CONVERGED] 
    ## 
    ##   Components (fit)  
    ##      Tail    n = 71 (0.53)    Shape = 0.93 
    ##   Beta C1    n = 67 (0.47)    Mean = 0.38
    ## 
    ##   Scores (model selection)  
    ##       NLL       BIC      AIC  entropy      ICL reduced.entropy     reICL
    ##  -109.947 -175.5487 -201.894 20.63779 -154.911               0 -175.5487
    ##  size
    ##     9
    ## 
    ## 
    ## ------------
    ## MOBSTER fits
    ## ------------
    ## [ MOBSTER ] N = 154 points with K = 3 Beta clusters, fit by MM in 186 steps [CONVERGED] 
    ## 
    ##   Components (fit)  
    ## Tail OFF
    ##   Beta C1    n = 1 (0.01)     Mean = 0.88
    ##   Beta C2    n = 79 (0.51)    Mean = 0.34
    ##   Beta C3    n = 74 (0.48)    Mean = 0.08
    ## 
    ##   Scores (model selection)  
    ##        NLL       BIC       AIC  entropy       ICL reduced.entropy
    ##  -150.8785 -246.3506 -279.7571 4.341417 -242.0092        4.341417
    ##      reICL size
    ##  -242.0092   11
    ## [ MOBSTER ] N = 122 points with K = 1 Beta clusters, fit by MM in 1 steps [CONVERGED] 
    ## 
    ##   Components (fit)  
    ## Tail OFF
    ##   Beta C1    n = 122 (1)      Mean = 0.25
    ## 
    ##   Scores (model selection)  
    ##        NLL       BIC       AIC entropy       ICL reduced.entropy     reICL
    ##  -68.16518 -112.3103 -126.3304       0 -112.3103               0 -112.3103
    ##  size
    ##     5
    ## [ MOBSTER ] N = 138 points with K = 1 Beta clusters, fit by MM in 56 steps [CONVERGED] 
    ## 
    ##   Components (fit)  
    ##      Tail    n = 71 (0.53)    Shape = 0.93 
    ##   Beta C1    n = 67 (0.47)    Mean = 0.38
    ## 
    ##   Scores (model selection)  
    ##       NLL       BIC      AIC  entropy      ICL reduced.entropy     reICL
    ##  -109.947 -175.5487 -201.894 20.63779 -154.911               0 -175.5487
    ##  size
    ##     9

Projecting tail mutations

``` r
fit_prj = mobster_flt_projection(fit)
```

    ## 
    ## --------------------------
    ## Global projection strategy
    ## --------------------------
    ##  Entries to project 71 
    ## # A tibble: 71 x 5
    ##    id       Set6_42 Set6_44 Set6_45 projected
    ##    <chr>    <chr>   <chr>   <chr>   <lgl>    
    ##  1 __mut174 C3      <NA>    Tail    TRUE     
    ##  2 __mut250 C2      C1      Tail    TRUE     
    ##  3 __mut287 C3      <NA>    Tail    TRUE     
    ##  4 __mut297 C3      <NA>    Tail    TRUE     
    ##  5 __mut308 C2      C1      Tail    TRUE     
    ##  6 __mut319 C2      C1      Tail    TRUE     
    ##  7 __mut337 C2      C1      Tail    TRUE     
    ##  8 __mut346 C2      C1      Tail    TRUE     
    ##  9 __mut381 C3      C1      Tail    TRUE     
    ## 10 __mut385 C2      C1      Tail    TRUE     
    ## # ... with 61 more rows

## Fitting read counts with Binomial clusters

``` r
fit_prj = mobster_fit_VIBER(fit_prj)
```

    ## Loading required package: VIBER

    ## 
    ## Attaching package: 'VIBER'

    ## The following objects are masked from 'package:mobster':
    ## 
    ##     plot_latent_variables, plot_mixing_proportions

    ## 
    ## ----------------------------------------------------
    ## Input for variational Binomial clustering with VIBER
    ## ----------------------------------------------------
    ##  NV values   # A tibble: 362 x 4
    ##    id       Set6_42 Set6_44 Set6_45
    ##    <chr>      <dbl>   <dbl>   <dbl>
    ##  1 __mut252       0       0       0
    ##  2 __mut256       0       6       0
    ##  3 __mut272       0       0       0
    ##  4 __mut348       0       5       0
    ##  5 __mut415       0       5       0
    ##  6 __mut441       7       0       0
    ##  7 __mut6         0       0       0
    ##  8 __mut23        0       0       0
    ##  9 __mut69        4       0       0
    ## 10 __mut87        0       0       0
    ## # ... with 352 more rows
    ##  DP values  # A tibble: 362 x 4
    ##    id       Set6_42 Set6_44 Set6_45
    ##    <chr>      <dbl>   <dbl>   <dbl>
    ##  1 __mut252       0       0       0
    ##  2 __mut256       0      60       0
    ##  3 __mut272       0       0       0
    ##  4 __mut348       0      57       0
    ##  5 __mut415       0      54       0
    ##  6 __mut441      65       0       0
    ##  7 __mut6         0       0       0
    ##  8 __mut23        0       0       0
    ##  9 __mut69       87       0       0
    ## 10 __mut87        0       0       0
    ## # ... with 352 more rows
    ##  [ VIBER - variational fit ] 
    ## 
    ##  INPUT 
    ##   Points N = 362  
    ## Clusters K = 10 (max)
    ##  
    ## Dirichlet alpha = 1e-06 (conc.) 
    ##      Beta a0 = 1; b0 =1 (shape)
    ##  
    ##      Beta (posterior) prior  
    ##  Optimize epsilon = 1e-10; steps =5000; r = 10 
    ## 
    ##  [easypar] Registering multiple cores:  2 out of 4 [ratio 80%] 
    ##  [easypar] Stopping parallel clusters.   
    ## 
    ## 
    ## BEST FIT
    ## 
    ##  [ mvbmm - Variational fit for Binomial mixtures ] 
    ##  
    ##     Points N = 362  
    ## Dimensions W = 3  
    ##        Fit CONVERGED (24 steps; eps. 1e-10) with Variational  
    ## 
    ## Binomial parameters (2 digits rounded) 
    ##  # A tibble: 3 x 10
    ##      C1   C10    C2    C3    C4    C5    C6    C7    C8    C9
    ##   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
    ## 1  0.08  0.36   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
    ## 2  0.08  0.36   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
    ## 3  0.4   0.39   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
    ##  
    ## Proportions (ordered)  
    ## # A tibble: 10 x 2
    ##    entry         value
    ##  * <chr>         <dbl>
    ##  1 C1    0.816        
    ##  2 C10   0.184        
    ##  3 C2    0.00000000276
    ##  4 C3    0.00000000276
    ##  5 C4    0.00000000276
    ##  6 C5    0.00000000276
    ##  7 C6    0.00000000276
    ##  8 C7    0.00000000276
    ##  9 C8    0.00000000276
    ## 10 C9    0.00000000276
    ## 
    ## 
    ## COMPLETED: 0.09 mins, with status CONVERGED

which we can print via `VIBER` functions

``` r
require(VIBER)
plot(fit_prj$fit.Binomial)
```

    ## [[1]]

![](Untitled_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->

    ## 
    ## [[2]]

![](Untitled_files/figure-gfm/unnamed-chunk-11-2.png)<!-- -->

    ## 
    ## [[3]]

![](Untitled_files/figure-gfm/unnamed-chunk-11-3.png)<!-- -->

or other `VIBER` functions

``` r
plot_mixing_proportions(fit_prj$fit.Binomial)
```

![](Untitled_files/figure-gfm/unnamed-chunk-12-1.png)<!-- -->

``` r
plot_ELBO(fit_prj$fit.Binomial)
```

![](Untitled_files/figure-gfm/unnamed-chunk-12-2.png)<!-- -->

## Standard analysis

``` r
standard = mobster_fit_VIBER(fit)
```

    ## 
    ## ----------------------------------------------------
    ## Input for variational Binomial clustering with VIBER
    ## ----------------------------------------------------
    ##  NV values   # A tibble: 433 x 4
    ##    id       Set6_42 Set6_44 Set6_45
    ##    <chr>      <dbl>   <dbl>   <dbl>
    ##  1 __mut252       0       0       0
    ##  2 __mut256       0       6       0
    ##  3 __mut272       0       0       0
    ##  4 __mut348       0       5       0
    ##  5 __mut415       0       5       0
    ##  6 __mut441       7       0       0
    ##  7 __mut6         0       0       0
    ##  8 __mut23        0       0       0
    ##  9 __mut69        4       0       0
    ## 10 __mut87        0       0       0
    ## # ... with 423 more rows
    ##  DP values  # A tibble: 433 x 4
    ##    id       Set6_42 Set6_44 Set6_45
    ##    <chr>      <dbl>   <dbl>   <dbl>
    ##  1 __mut252       0       0       0
    ##  2 __mut256       0      60       0
    ##  3 __mut272       0       0       0
    ##  4 __mut348       0      57       0
    ##  5 __mut415       0      54       0
    ##  6 __mut441      65       0       0
    ##  7 __mut6         0       0       0
    ##  8 __mut23        0       0       0
    ##  9 __mut69       87       0       0
    ## 10 __mut87        0       0       0
    ## # ... with 423 more rows
    ##  [ VIBER - variational fit ] 
    ## 
    ##  INPUT 
    ##   Points N = 433  
    ## Clusters K = 10 (max)
    ##  
    ## Dirichlet alpha = 1e-06 (conc.) 
    ##      Beta a0 = 1; b0 =1 (shape)
    ##  
    ##      Beta (posterior) prior  
    ##  Optimize epsilon = 1e-10; steps =5000; r = 10 
    ## 
    ##  [easypar] Registering multiple cores:  2 out of 4 [ratio 80%] 
    ##  [easypar] Stopping parallel clusters.   
    ## 
    ## 
    ## BEST FIT
    ## 
    ##  [ mvbmm - Variational fit for Binomial mixtures ] 
    ##  
    ##     Points N = 433  
    ## Dimensions W = 3  
    ##        Fit CONVERGED (26 steps; eps. 1e-10) with Variational  
    ## 
    ## Binomial parameters (2 digits rounded) 
    ##  # A tibble: 3 x 10
    ##      C1    C6    C2    C3    C4    C5    C7    C8    C9   C10
    ##   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
    ## 1  0.08  0.36   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
    ## 2  0.08  0.36   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
    ## 3  0.08  0.39   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
    ##  
    ## Proportions (ordered)  
    ## # A tibble: 10 x 2
    ##    entry         value
    ##  * <chr>         <dbl>
    ##  1 C1    0.812        
    ##  2 C6    0.188        
    ##  3 C2    0.00000000231
    ##  4 C3    0.00000000231
    ##  5 C4    0.00000000231
    ##  6 C5    0.00000000231
    ##  7 C7    0.00000000231
    ##  8 C8    0.00000000231
    ##  9 C9    0.00000000231
    ## 10 C10   0.00000000231
    ## 
    ## 
    ## COMPLETED: 0.09 mins, with status CONVERGED

``` r
require(VIBER)
plot(standard$fit.Binomial)
```

    ## [[1]]

![](Untitled_files/figure-gfm/unnamed-chunk-14-1.png)<!-- -->

    ## 
    ## [[2]]

![](Untitled_files/figure-gfm/unnamed-chunk-14-2.png)<!-- -->

    ## 
    ## [[3]]

![](Untitled_files/figure-gfm/unnamed-chunk-14-3.png)<!-- -->

or other `VIBER` functions

``` r
plot_mixing_proportions(standard$fit.Binomial)
```

![](Untitled_files/figure-gfm/unnamed-chunk-15-1.png)<!-- -->

``` r
plot_ELBO(standard$fit.Binomial)
```

![](Untitled_files/figure-gfm/unnamed-chunk-15-2.png)<!-- -->
